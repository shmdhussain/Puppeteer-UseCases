'use strict'
snaApp.directive('bindHtmlCompile',['$compile',function($compile){return{restrict:'A',link:function(scope,element,attrs){scope.$watch(function(){return scope.$eval(attrs.bindHtmlCompile);},function(value){element.html(value);removeLastEmptyParagraphInArticleBody();$compile(element.contents())(scope);});function removeLastEmptyParagraphInArticleBody(){if(attrs.bindHtmlContentType=='article'){var lastParaEl=element.find("> p:last-child");var lastParaContent;if(lastParaEl&&lastParaEl.length>0){lastParaContent=lastParaEl.html().trim();var lastParaContentMatchForEmptyStrings=lastParaContent.match(/^(&nbsp;)*$/g);if(lastParaContentMatchForEmptyStrings&&lastParaContentMatchForEmptyStrings.length>0){lastParaEl.remove();}}}}}};}]);snaApp.directive("snaImage",['$rootScope','$interval','$timeout','$http','appConfig','$log',function($rootScope,$interval,$timeout,$http,appConfig,$log){function link(scope,element,attrs){scope.$watch("content",function(content){if(!content){return}
if(attrs.position&&attrs.position!="undefined"){scope.position=attrs.position;}})}
return{restrict:'E',scope:{content:'=content',viewportWidth:'@'},link:link,templateUrl:$rootScope.templateBaseUrl+"/html/template/snaImage.html"}}]);snaApp.directive("sna",['$rootScope','$interval','$timeout','$http','appConfig','$log',function($rootScope,$interval,$timeout,$http,appConfig,$log){function link(scope,element,attrs){var inlineItems=scope.$parent.inlineItems||[],inlineItem,allowPosition=scope.$parent.allowPosition,articleModal=scope.$parent.articleModal;if(typeof scope.$parent.article!="undefined"&&typeof scope.$parent.article.inlineItems!="undefined"&&Array.isArray(scope.$parent.article.inlineItems)&&scope.$parent.article.inlineItems.length>0){inlineItems=scope.$parent.article.inlineItems;}
for(var i=0;i<inlineItems.length;i++){if(attrs.refid==inlineItems[i].id){scope.inlineItem=inlineItems[i];inlineItem=inlineItems[i];break}}
var viewportWidth="";var bottomImgViewportWidth="";var nosidebar="false";var setImageGalleryViewportWidth=function(){if((!attrs.reftype.toLowerCase()=='image_gallery')||(!attrs.reftype.toLowerCase()=='video')||(!attrs.reftype.toLowerCase()=='image_set')){return;}
if(typeof scope.$parent.article!="undefined"&&location.pathname.split("/")[2].toLowerCase()=="article"){viewportWidth="[ [1, 0.66], [1, 0.83], [1, 1] ]";bottomImgViewportWidth="[ [.66, .16], [.83, .25], [1, 1] ]";}else if(typeof scope.$parent.blog!="undefined"){viewportWidth="[ [.66, 1], [.83, 1], [1, 1] ]";bottomImgViewportWidth="[ [.66, .16], [.83, .25], [1, 1] ]";}else if(typeof scope.$parent.staticPage!="undefined"){viewportWidth="[ [.75], [.66], [1] ]";bottomImgViewportWidth="[ [.75, .16], [.66, .25], [1, 1] ]";}else if(typeof scope.$parent.article!="undefined"&&location.pathname.split("/")[2].toLowerCase()=="timeline"){viewportWidth="[ [1, 0.583], [1, 0.66], [1, 1] ]";bottomImgViewportWidth="[ [.583, .16], [.66, .25], [1, 1] ]";nosidebar="true";}}
setImageGalleryViewportWidth();var flyout=scope.$parent.flyout||false;scope.flyout=flyout;if(attrs.reftype.toLowerCase()=='image_set'){scope.contentHtml="<sna-image content='inlineItem' viewport-width='{{"+viewportWidth+"}}' refid='"+attrs.refid+"'"+(allowPosition?" position='"+attrs.position+"'":"")+"></sna-image>";}else if(attrs.reftype.toLowerCase()=='video'){if(flyout){scope.contentHtml='<img src="/static/web-rev/img/default_img.jpg" style="width: 100%"/>'+'<img class="main-image article-image" data-ng-src="{{\'/web/images\' + inlineItem.mediaAsset.imageUrl | imageAdvFilter:'+viewportWidth+':0.563:'+nosidebar+'}}" style="width: 100%;position: absolute; top: 0; left:0;height: 100%" onload="showImage();" />'+"<sna-video image-gallery-on-full-page='{{"+nosidebar+"}}'  viewport-width='{{"+viewportWidth+"}}' jw-player-media-id='inlineItem.jwPlayerMediaId' autoplay='true' postLoad='false' flyout='true' content='inlineItem' refid='"+attrs.refid+"' "+(scope.$parent.prerollTag?"preroll-tag='"+scope.$parent.prerollTag+"'":"")+'></sna-video>';}else{scope.contentHtml="<sna-video image-gallery-on-full-page='{{"+nosidebar+"}}'  viewport-width='{{"+viewportWidth+"}}' jw-player-media-id='inlineItem.jwPlayerMediaId' autoplay='true' postLoad='false' flyout='"+flyout+"' content='inlineItem' refid='"+attrs.refid+"' "+(scope.$parent.prerollTag?"preroll-tag='"+scope.$parent.prerollTag+"'":"")+"></sna-video>";}}else if(attrs.reftype.toLowerCase()=='image_gallery'){scope.contentHtml="<sna-image-gallery image-gallery-on-full-page='{{"+nosidebar+"}}' bottom-img-viewport-width='{{"+bottomImgViewportWidth+"}}' viewport-width='{{"+viewportWidth+"}}' image-gallery='true' content='inlineItem' refid='"+attrs.refid+"' article-modal='"+articleModal+"' trigger-full-screen-slide-show-on-click='true'></sna-image-gallery>";}else if(attrs.reftype.toLowerCase()=='custom_html'){scope.contentHtml="<sna-custom-html content='inlineItem' refid='"+attrs.refid+"'></sna-custom-html>";}else if(attrs.reftype.toLowerCase()=='poll'){scope.contentHtml="<sna-poll content='inlineItem' refid='"+attrs.refid+"' position='"+attrs.position+"'></sna-poll>";}else if(attrs.reftype.toLowerCase()=='poll_apester'){scope.contentHtml="<sna-poll-apster content='inlineItem' refid='"+attrs.refid+"'></sna-poll-apster>";}else if(attrs.reftype.toLowerCase()=='quote'){scope.contentHtml="<sna-quote content='inlineItem' refid='"+attrs.refid+"' position='"+attrs.position+"'></sna-quote>";}else if(attrs.reftype.toLowerCase()=='youtube_video'&&!!getVideoIdFromYoutubeUrl(inlineItem.url)){scope.contentHtml="<sna-youtube-video content='inlineItem' flyout='false' one-time-bind-yt-video-id='"+getVideoIdFromYoutubeUrl(inlineItem.url)+"'></sna-youtube-video>";}}
return{restrict:'E',scope:{refid:"=refid"},link:link,templateUrl:$rootScope.templateBaseUrl+"/html/template/snaBase.html"}}]);function getVideoIdFromYoutubeUrl(url){var regExp=/https?:\/\/www.youtube.com\/watch\?v=((?=\S)[^\&#]+)&*(\S)*/i;var result=!!regExp.exec(url)&&regExp.exec(url)[1];return result;};snaApp.controller("programCarouselController",["$scope","$http","appConfig","$window","$log","$location","$filter",function($scope,$http,appConfig,$window,$log,$location,$filter){$scope.programCarousel=$scope.component.sectionContents;var width=1600;var height=Math.round(width*5/17);$scope.programCarouselImages=[];$scope.programUrl=[];for(var i=0;i<$scope.programCarousel.length;i++){var obj=$scope.programCarousel[i];$scope.programCarouselSet=obj.web_listing_page_image.imageUrl;if($scope.programCarouselSet){$scope.programCarouselImages[i]=$filter('imageAdvFilter')($scope.programCarouselSet,[[.25],[.33],[1]],.294);}
$scope.programUrl[i]='program'+obj.url+'-'+obj.urlFriendlySuffix;}
$scope.$applyAsync(function(){$('.program_carousel').slick({rtl:true,dots:true,arrows:false,autoplay:true,autoplaySpeed:5000,mobileFirst:true})});}]);'user strict'
snaApp.controller("episodesController",["$scope","appConfig","$log","timeDifference","youtubeApi",function($scope,appConfig,$log,timeDifference,youtubeApi){var contents=$scope.component.sectionContents;var videos=[];var index=0;var videoIndex=0;var successCallback=function(data){if(data.items&&data.items.length>0){videos[videoIndex]=data.items[0];videoIndex++;}
if(++index<contents.length){youtubeApi.listPlaylistItems(contents[index].youtubePlayListId,1).success(successCallback);}else{$scope.videos=videos;$scope.requestsCompoleted=true;}}
youtubeApi.listPlaylistItems(contents[index].youtubePlayListId,1).success(successCallback);}]);snaApp.controller("blogsController",["$rootScope","$scope","appConfig","$log","timeDifference",function($rootScope,$scope,appConfig,$log,timeDifference){$scope.contents=$scope.component.contents;}]);snaApp.controller("cartoonController",["$scope","$http","appConfig","$window","$log","$location","$filter",function($scope,$http,appConfig,$window,$log,$location,$filter){$scope.cartoonGallery=$scope.component.contents;$scope.cartoonId=$scope.component.contents[0].id;$scope.cartoonImagesContainer=$scope.cartoonGallery[0].cartoonImages;}]);'use strict'
snaApp.controller("pollsController",["$rootScope","$scope",'$element','$sce',function($rootScope,$scope,$element,$sce){$scope.polls=$scope.component.contents;if($scope.polls[0]!=='undefined'&&$scope.polls[0].type!=='undefined'){$scope.pollType=$scope.polls[0].type;}
if($scope.pollType=='POLL_APESTER'){$scope.pollEmbedCode=$sce.trustAsHtml($scope.polls[0].freeText);return;}
var pollWidgetDom=$element;if($scope.polls[0].freeText!=null&&$scope.polls[0].freeText!=''){var poll=$('<iframe name="poll_iframe" class="poll_frame" width="100%" scrolling="no" style="overflow:hidden;border-top: 0;"></iframe>');pollWidgetDom.find('#poll_wrapper').append(poll);var initScript='<script>';initScript+='setTimeout(function() {setHeight(document.getElementsByClassName("PDS_Poll")[0].offsetHeight + 25);';initScript+='setHeight(document.getElementsByClassName("PDS_Poll")[0].offsetHeight + 25);}, 500);window.stop && window.stop();';initScript+='if (navigator.userAgent && navigator.userAgent.match(/Windows Phone/i) || true) {'
initScript+='window.addEventListener("resize", function (event) {';initScript+='setHeight(document.getElementsByClassName("PDS_Poll")[0].offsetHeight + 25)';initScript+='});}';initScript+='var insertListener = function(event){';initScript+='if (event.animationName == "nodeInserted") {';initScript+='setTimeout(function() { setHeight(document.getElementsByClassName("PDS_Poll")[0].offsetHeight + 50); }, 100);';initScript+='}};';initScript+='document.addEventListener("animationstart", insertListener, false); ';initScript+='document.addEventListener("MSAnimationStart", insertListener, false); ';initScript+='document.addEventListener("webkitAnimationStart", insertListener, false); ';initScript+='</script>';pollWidgetDom.find('#poll_wrapper iframe')[0].contentWindow.document.write('<body id="sna-poll" style="margin: 0;">'
+'<script src="'+$rootScope.appAssetsUrl+'/js/pollTheme/pollAnimation.js"></script>'
+$scope.polls[0].freeText+initScript+"</body>");pollWidgetDom.find('#poll_wrapper iframe')[0].contentWindow.setHeight=function(pollHeight){pollWidgetDom.find('#poll_wrapper iframe')[0].height=pollHeight;if(!(pollWidgetDom.find('#poll_wrapper iframe').contents().find('#pollStyle').length>0)){pollWidgetDom.find('#poll_wrapper iframe').contents().find('head').append('<style id="pollStyle"></style>');}
if(!(pollWidgetDom.find('#poll_wrapper iframe').contents().find('#pollIFrameHeight').length>0)){pollWidgetDom.find('#poll_wrapper iframe').contents().find('head').append("<style id='pollIFrameHeight'> @keyframes nodeInserted {from { opacity: 0.99; } to { opacity: 1; } }   "
+"@-webkit-keyframes nodeInserted {from { opacity: 0.99; } to { opacity: 1; } }  "
+"@-ms-keyframes nodeInserted {from { opacity: 0.99; } to { opacity: 1; } }"
+".PDS_Poll  div.pds-question, .PDS_Poll  div.pds-answer, .PDS_Poll  "
+"div.pds-vote {animation-duration: 0.001s; animation-name: nodeInserted; -webkit-animation-duration: 0.001s; "
+"-webkit-animation-name: nodeInserted; -ms-animation-duration: 0.001s; -webkit-ms-name: nodeInserted;}</style>");}
resetPollStyle();}
window.addEventListener('orientationchange',function(){resetPollStyle();});if(navigator.userAgent&&navigator.userAgent.match(/Windows Phone/i)){$(window).on('resize',function(){resetPollStyle();});}
pollWidgetDom.find('#poll_wrapper iframe').contents().find('head').append('<style>body { font-family: HelveticaNeue, Helvetica, Arial, sans-serif;}</style>');var font='<style>\n@font-face {\n'
font+='font-family: "HelveticaNeue";\n';font+='src:    url("'+$rootScope.appAssetsUrl+'/styles/sna-font/HelveticaNeueW23forSKY-Reg_T02.woff2")  format("woff2"),\n';font+='        url("'+$rootScope.appAssetsUrl+'/styles/sna-font/HelveticaNeueW23forSKY-Reg_T02.woff")   format("woff");\n';font+='font-weight: 400;\n';font+='font-style: normal;\n';font+='}\n</style>'
pollWidgetDom.find('#poll_wrapper iframe').contents().find('head').append(font);}
function resetPollStyle(){var h3FontSize=$(".poll-widget .poll-headline").css("font-size");var h4FontSize=$(".poll-widget .poll-answer").css("font-size");var style='.pds-question-top { font-size:'+h3FontSize+' !important;}\n';style+='.pds-input-label { font-size:'+h4FontSize+' !important;}\n';style+='.pds-answer-text { font-size:'+h4FontSize+' !important;}\n';style+='.pds-vote-button { font-size:'+h4FontSize+' !important;}\n';style+='.pds-return-poll { font-size:'+h4FontSize+' !important;}\n';style+='.pds-return-poll {margin-top: 0 !important;}\n';style+='.pds-vote {margin-top: 10px !important;}\n'
pollWidgetDom.find('#poll_wrapper iframe').contents().find('#pollStyle').html(style);}}]);snaApp.controller("topContributorsController",["$scope","$http","appConfig","$window","$log","$location",'timeDifference',function($scope,$http,appConfig,$window,$log,$location,timeDifference){var width=800;var height=Math.round(width*1/1);$scope.topContributorsList=[];$scope.topContributorsImages=[];var topContributors=0;for(var i=0;i<$scope.component.contents.length;i++){$scope.topContributorsList[topContributors]=$scope.component.contents[i];$scope.topContributorsImages[topContributors]=$scope.component.contents[i].mediaAsset.imageUrl.replace("{width}",Math.round(width/3)).replace("{height}",Math.round(height/3));topContributors++;}}]);snaApp.controller("iframeController",["$scope","$sce",function($scope,$sce){$scope.iframeSrc=$sce.trustAsResourceUrl($scope.component.contents[0].sourceUrl);$scope.iframeHeight=$scope.component.contents[0].height;}]);snaApp.controller("sidebarController",["$scope","$http","appConfig","$window","$log","$location","$rootScope",function($scope,$http,appConfig,$window,$log,$location,$rootScope){$rootScope.hideImage=false;$scope.filterComponents=function(value,index){if(value.componentType=='VIDEO_BULLETIN'||value.componentType=='PROGRAM_CAROUSEL'||(value.componentType=='EPISODES'&&$rootScope.deviceType!='MOBILE')||value.componentType=='BLOGS'||value.componentType=='CARTOONGALLERY'||value.componentType=='POLLS'||value.componentType=='TOP_CONTRIBUTORS'||(value.componentType=='CUSTOMHTML'&&($rootScope.deviceType!='MOBILE'||(value.title.indexOf('تويتر')==-1&&value.title.toLowerCase().indexOf('twitter')==-1)))||value.componentType=='IFRAME'||value.componentType=='COMMODITY_CURRENCIES_TAB'||value.componentType=='MARKETS'||value.componentType=='POPULAR_LEAGUES'||value.componentType=='STOCKS'||value.componentType=='LATEST_NEWS'||value.componentType=='TOP_SCORERS'||value.componentType=='MATCH_RESULTS'||value.componentType=='RANKINGS_TENNIS'||value.componentType=='RANKINGS_MOTORSPORTS'||value.componentType=='RANKINGS_BASKETBALL'||value.componentType=='POPULAR_STORIES'||value.componentType=='VIDEO_WIDGET'){return true;}else{return false;}};}]);snaApp.controller("programListController",["$scope","$http","appConfig","$window","$log","$location","$rootScope","$timeout",function($scope,$http,appConfig,$window,$log,$location,$rootScope,$timeout){$rootScope.contentTheme="dark-theme";$rootScope.menuLocationUrl=window.location.protocol+"//"+window.location.host+window.location.pathname;function removeSlashAtUrlEnd(url){while(/\/$/.test(url)){url=url.replace(/\/$/,"");}
return url;}
$rootScope.menuLocationUrl=removeSlashAtUrlEnd($rootScope.menuLocationUrl);$http.get(appConfig.apiBaseURL+'/rest/v2/programs.json?deviceType='+$rootScope.deviceType).then(function(response){var data=response.data;$scope.programs=data.programs;var groupItem;$scope.programGroup=[];if(lodash.get(data,"programs.length",0)){for(var i=0;i<data.programs.length;i++){if(i%2==0){groupItem=[];groupItem.push(data.programs[i]);}else{groupItem.push(data.programs[i]);$scope.programGroup.push(groupItem);}}}
$rootScope.pageDescription='قائمة ببرامج سكاي نيوز عربية على التلفزيون مع روابط لصفحاتها الخاصة على الموقع التي تضم فيديوهات لكل الحلقات مع مواعيد البث والإعادة';$scope.$applyAsync(function(){$(document).foundation({equalizer:{check_window_height_width:true,}});registerMenuCloseEvent();});},function(){$log.error("Error Fetching programs list");});}]);snaApp.controller("programController",["$scope","$http","appConfig","$window","$log","$location","$rootScope","$timeout","$filter",function($scope,$http,appConfig,$window,$log,$location,$rootScope,$timeout,$filter){if(!$scope.initData||!$scope.initData.components){alert("no initialization data");}
var locationUrl=$location.protocol()+"://";locationUrl+=$location.host();locationUrl+=$location.port()&&$location.port()!=80&&$location.port()!=443?":"+$location.port():'';locationUrl+="/"+appConfig.webContext+"/";var sharingBaseUrl='https://'+appConfig.sharingHost+'/'+appConfig.webContext;var imageBaseUrl='https://'+appConfig.sharingHost+'/'+appConfig.webContext+'/images/';$rootScope.menuLocationUrl=locationUrl+'programs';function removeSlashAtUrlEnd(url){while(/\/$/.test(url)){url=url.replace(/\/$/,"");}
return url;}
$rootScope.menuLocationUrl=removeSlashAtUrlEnd($rootScope.menuLocationUrl);$scope.hidePollImage=true;$rootScope.contentTheme="dark-theme";$rootScope.pageDescription='قائمة ببرامج سكاي نيوز عربية على التلفزيون مع روابط لصفحاتها الخاصة على الموقع التي تضم فيديوهات لكل الحلقات مع مواعيد البث والإعادة';$http.get(appConfig.apiBaseURL+'/rest/v2'+$scope.initData.url+'.json?deviceType='+$rootScope.deviceType).then(function(response){var data=response.data;$scope.components=data.sectionComponents;$scope.sidebarComponents=data.sideBarComponents;$scope.program=data;$rootScope.pageDescription=data.description;$rootScope.Sheadline=data.displayName;$rootScope.Surl=sharingBaseUrl+$rootScope.initData.url;$rootScope.Simage=imageBaseUrl+$filter('imagefilter')(data.web_listing_page_image.imageUrl,1200,0.525);$rootScope.Ssummary=data.description;$timeout(function(){$('#programContainerDiv').css("visibility",'visible');loadTwitter();if(typeof appConfig!="undefined"&&appConfig.webContext!='publisher'){loadFacebook();}},1000,false);},function(){$log.error("Error Fetching program data");});$scope.filterComponents=function(value,index){if(value.componentType=='FEATURED'||value.componentType=='TOPSTORIES'||value.componentType=='HYBRID'||value.componentType=='VIDEO_BULLETIN'||value.componentType=='COMPACT'||value.componentType=='EMBED_ITEM'){return true;}else{return false;}}
function loadTwitter(){window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id)){return t;}
js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));}
function loadFacebook(){(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id)){return;}
js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/ar_AR/sdk.js#xfbml=1&version=v2.6&appId=244590942255207";fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));}
$scope.encodeURIComponent=window.encodeURIComponent;}]);snaApp.controller("compactController",["$scope","$rootScope","appConfig","$log","timeDifference",function($scope,$rootScope,appConfig,$log,timeDifference){var contents=$scope.component.contents,groupSize=3;var width=800;var height=width*9/16;$scope.compactEven=contents.length%2==0;var contentType=contents[0].type;for(var i=0;i<contents.length;i++){if(!contents[i]){continue;}
if(contentType==null||contentType!=contents[i].type||contentType.toLowerCase()=='article'){contentType=null;}}
$scope.contentType=contentType;$scope.storyGroups=[];if($scope.groupSize){groupSize=$scope.groupSize;}else if($scope.perDevice){if($rootScope.deviceType=='DESKTOP'){groupSize=3;}else if($rootScope.deviceType=='TABLET'){groupSize=2;}else{groupSize=1;}}else if(contents[0].type.toLowerCase()=='article'&&$rootScope.deviceType=='MOBILE'){groupSize=1;}
for(var i=0;i<contents.length;i+=groupSize){var group=[];for(var j=0;j<groupSize;j++){if(!contents[j+i]){continue;}
group[j]=contents[j+i];}
$scope.storyGroups.push(group);}}]);snaApp.controller("hybridController",["$scope","$http","appConfig","$window","$log","$timeout","$location",'timeDifference',function($scope,$http,appConfig,$window,$log,$timeout,$location,timeDifference){$scope.hybrid=$scope.component.contents;$scope.filterHybridArticle=function(value,index){if(value.type=='ARTICLE'){return true;}else{return false;}};$scope.filterHybridImageVideo=function(value,index){if(value.type=='VIDEO'||value.type=='IMAGE_GALLERY'){return true;}else{return false;}};$scope.hybridImageUrlSmall=[];$scope.hybridImageUrlMedium=[];$scope.hybridImageUrlLarge=[];$scope.hybridImagecounts=[];$scope.hybridVideoDuration=[];$scope.hybridRevisionDate=[];$scope.publishedDate=[];$scope.articlesList=[];$scope.multiMediaList=[];var articleIndex=0;var multiMediaIndex=0;for(var i=0;i<$scope.hybrid.length;i++){var obj=$scope.hybrid[i];if(obj.type=='ARTICLE'){$scope.articlesList[articleIndex]=obj;articleIndex++;}else if(obj.type=='VIDEO'||obj.type=='IMAGE_GALLERY'){if(obj.runTime!=undefined){if(obj.runTime.slice(0,2)=="00"){obj.runTime=obj.runTime.slice(3,8);}else if(obj.runTime.slice(0,2)!="00"){obj.runTime=obj.runTime.slice(0,8);}}
$scope.multiMediaList[multiMediaIndex]=obj;multiMediaIndex++;}}
$timeout(function(){$(document).foundation('equalizer','reflow');},500,false);}]);snaApp.controller("featuredController",["$scope","$http","appConfig","$window","$log","$location",'timeDifference','$sce',function($scope,$http,appConfig,$window,$log,$location,timeDifference,$sce){$scope.stories=$scope.component.contents;var width=1600;var height=Math.round(width*9/16);$scope.isBreaking=$scope.stories[0].isBreaking;$scope.filterfeaturedAssets=function(value,index){if(value.type=='IMAGE_SET'||value.type=='VIDEO'||value.type=='IMAGE_GALLERY'||value.type=='POLL'){return true;}else{return false;}};var delay=300,setTimeoutConst;$scope.teaserOnHover=function(event){var targetElement=$(event.target).closest('.main-hero-side-content');var currentTeaserId=$(targetElement).find('video').attr('id');if(!currentTeaserId||currentTeaserId==''){return;}
$(targetElement).parent().find('video').each(function(index,video){if(currentTeaserId!=$(video).attr('id')){video.pause();}else{video.play();}});if($(targetElement).find('video').hasClass('teaser-video-2')){$('.hero-related').animate({'marginTop':'-80px'});}
setTimeoutConst=setTimeout(function(){$(targetElement).find('video:first').prop('muted',false);},delay);};$scope.teaserOnLeave=function(event){var targetElement=$(event.target).closest('.main-hero-side-content');var currentTeaserId=$(targetElement).find('video').attr('id');if(!currentTeaserId||currentTeaserId==''){return;}
$('.hero-related').animate({'marginTop':'0'});$(targetElement).find('video:first').prop('muted',true);$(targetElement).parent().find('video').each(function(index,video){video.play();});clearTimeout(setTimeoutConst);};$scope.videoTeaserLoaded=function(index){var vteasers=document.querySelectorAll('#main-hero-side-content video');for(i=0;i<vteasers.length;i++){$(vteasers[i]).prop('muted',true);$(vteasers[i]).on('loadeddata',function(e){$(this).css('background','#000');});}};if($scope.stories[0].associatedAssets!=undefined){$scope.featuredAssets=$scope.stories[0].associatedAssets;angular.forEach($scope.featuredAssets,function(fa,key){if(fa.autoPlay){fa.teaserUrlSafe=$sce.trustAsResourceUrl(fa.teaserUrl);}});}else{$scope.featuredAssets=[];}}]);snaApp.controller("topStoriesController",["$scope","appConfig","$log","$timeout","timeDifference","$rootScope",'$window',function($scope,appConfig,$log,$timeout,timeDifference,$rootScope,$window){var contents=$scope.component.contents;var topStoriesCount=-1;var countIndex=$scope.$index;if($scope.components[0].componentType=="MEGANEWS"){var countIndex=$scope.$index+1;}
for(var i=0;i<=countIndex;i++){if($scope.components[i].name=="TOPSTORIES"){topStoriesCount++;}}
if($scope.startOdd){topStoriesCount++;}
if(topStoriesCount%2==0){$scope.topstoriesEven=true;$scope.topstoriesOdd=false;$scope.components[$scope.$index].isEven=true;}else{$scope.topstoriesEven=false;$scope.topstoriesOdd=true;$scope.components[$scope.$index].isEven=false;}
var width=800;var height=width*9/16;if($scope.component.adEnabled){if($rootScope.firstSectionTopStoriesAdShownRoot){$scope.firstSectionTopStoriesAdShown=true;}
$rootScope.firstSectionTopStoriesAdShownRoot=true;$scope.stories=[contents[0],contents[1],null,contents[2],contents[3]];}else{if($scope.component.auto){if($scope.topstoriesEven){if($scope.deviceType!='MOBILE'){$scope.stories=[contents[1],contents[2],contents[0],contents[3],contents[4]];}else{$scope.stories=[contents[0],contents[1],contents[2],contents[3],contents[4]];}}else{$scope.stories=[contents[0],contents[1],contents[4],contents[2],contents[3]];}}else{$scope.stories=[contents[1],contents[2],contents[0],contents[3],contents[4]];}}
$timeout(function(){$(document).foundation('equalizer','reflow');},500,false);$scope.clickOnSNADefaultAdBanner=function($event){if(!$($event.currentTarget).hasClass('inside-content-dfp-default-bg')){return;}
$window.location.href="https://www.skynewsarabia.com/web/staticpage/18991";}}]);snaApp.controller("videoBulletinController",["$scope","$http","appConfig","$window","$log","$location","$filter",function($scope,$http,appConfig,$window,$log,$location,$filter){if(!$scope.component){alert("no initialization data");}
var width=1600;var height=Math.round(width*9/16);$scope.videoBulletinResult=$scope.component.contents;$scope.videoBulletinImageUrlSmall=$scope.videoBulletinResult[0].mediaAsset.imageUrl.replace("{width}",Math.round(width/3)).replace("{height}",Math.round(height/3));$scope.videoBulletinImageUrlMedium=$scope.videoBulletinResult[0].mediaAsset.imageUrl.replace("{width}",Math.round(width/2)).replace("{height}",Math.round(height/2));$scope.videoBulletinImageUrlLarge=$scope.videoBulletinResult[0].mediaAsset.imageUrl.replace("{width}",Math.round(width)).replace("{height}",Math.round(height));}]);snaApp.controller("embedItemController",["$scope","$rootScope","appConfig","$log","youtubeApi","$sce","$timeout",function($scope,$rootScope,appConfig,$log,youtubeApi,$sce,$timeout){var nextPageToken,pageSize=7,groupSize=$rootScope.deviceType=='DESKTOP'?3:2,loadMore=true;$scope.episodeGroups=[];$scope.hasMore=false;$scope.selectedTab="featuredEpisode";$scope.embedItemComponent=$scope.component;for(var i=0;i<$scope.components.length;i++){if($scope.components[i].componentType=='STATIC_CONTENT_TOP'){$scope.staticComponent=$scope.components[i];$scope.showAboutProgram=true
$log.log("embed with static");break;}}
$scope.showEpisodes=true;$scope.showAboutProgram=true;if($scope.program&&$scope.program.youtubePlayListId&&$.trim($scope.program.youtubePlayListId)!=""){youtubeApi.listPlaylistItems($scope.program.youtubePlayListId,pageSize,nextPageToken,["snippet","contentDetails"]).success(episodeListSuccess);}
function episodeListSuccess(data){if(!$scope.featuredEpisode){$scope.featuredEpisode=data.items[0];$scope.featuredEpisode.videoUrl=$sce.trustAsResourceUrl('http://www.youtube.com/embed/'+$scope.featuredEpisode.snippet.resourceId.videoId+"?wmode=transparent");data.items=data.items.slice(1);}
for(var i=0;i<data.items.length;i+=groupSize){var episodeGroup=[];for(var j=0;j<groupSize;j++){if(!data.items[i+j]){break;}
episodeGroup.push(data.items[i+j]);}
$scope.episodeGroups.push(episodeGroup);}
nextPageToken=data.nextPageToken;if(nextPageToken){$scope.hasMore=true;}else{$scope.hasMore=false;}
pageSize=6;$log.log("Episodes",$scope.episodeGroups);$log.log("featured episode",$scope.featuredEpisode);$timeout(function(){$(document).foundation('equalizer','reflow');},500,false);loadMore=true;}
$scope.loadMoreEpisodes=function(){if(!loadMore){return;}
loadMore=false;youtubeApi.listPlaylistItems($scope.program.youtubePlayListId,pageSize,nextPageToken,["snippet","contentDetails"]).success(episodeListSuccess);}
$scope.selectProgramTab=function(tab){$scope.selectedTab=tab;}}]);snaApp.controller("customHtmlController",["$scope","$sce",function($scope,$sce){$scope.customHtml=$sce.trustAsHtml($scope.component.contents[0].freeText);$scope.openLink=function($event){if(typeof(cordova)=='undefined'){return true;}
$event.preventDefault();if($event&&$($event.target).attr('href')){window.open($($event.target).attr('href'),'_system')}}}]);snaApp.controller("staticContentController",["$scope","$sce",function($scope,$sce){$scope.customHtml=$scope.component.contents[0].body;$scope.inlineItems=$scope.component.contents[0].inlineItems;$scope.allowPosition=true;}]);snaApp.controller("programEpisodeController",["$scope","$http","appConfig","$log","$rootScope","$timeout","$sce","youtubeApi",'$location',function($scope,$http,appConfig,$log,$rootScope,$timeout,$sce,youtubeApi,$location){var nextPageToken,pageSize=$rootScope.deviceType=='TABLET'?3:4,loadMore=true,currentVideoId,bufferItem,isFirstTime="yes",isCurrentVideoMatched=false;$scope.episodeGroups=[];$scope.hasMore=false;$rootScope.contentTheme="dark-theme";var locationUrl=$location.protocol()+"://";locationUrl+=$location.host();locationUrl+=$location.port()&&$location.port()!=80&&$location.port()!=443?":"+$location.port():'';locationUrl+="/"+appConfig.webContext+"/";$rootScope.menuLocationUrl=locationUrl+'programs';$scope.episodeUrl=$sce.trustAsResourceUrl('https://www.youtube.com/embed/'+$scope.initData.id+"?rel=0&wmode=transparent&autoplay=1");youtubeApi.listVideos([$scope.initData.id],1).success(function(data){$scope.video=data.items[0];$rootScope.pageDescription=$scope.video.snippet.description;$rootScope.pageKeywords=$scope.video.snippet.tags;currentVideoId=$scope.video.id;});$scope.$applyAsync(function(){$(document).foundation();registerMenuCloseEvent();});if($rootScope.deviceType=='DESKTOP'){$timeout(function(){var articleMedia=$('.episode'),articleHead=$('.episode-head'),articleStickyHead=$('.article-head-sticky'),headerDiv=$('#headerDiv');$(window).scroll(function(){showStickyHeadline(articleMedia,articleHead,articleStickyHead,headerDiv);});showStickyHeadline(articleMedia,articleHead,articleStickyHead,headerDiv);},1000,true);}
function episodeListSuccess(data){var dataItemBufferArray=data.items;if(!isCurrentVideoMatched){for(var i=0;i<dataItemBufferArray.length;i++){if(dataItemBufferArray[i].snippet.resourceId.videoId==currentVideoId){dataItemBufferArray.splice(i,1);isCurrentVideoMatched=true;}}
if(dataItemBufferArray.length<pageSize&&bufferItem){dataItemBufferArray.splice(0,0,bufferItem);}else if(dataItemBufferArray.length>=pageSize){if(bufferItem){dataItemBufferArray.splice(0,0,bufferItem);}
bufferItem=dataItemBufferArray.pop();}}
if($rootScope.deviceType=='MOBILE'){$scope.episodeGroups.push([data.items[0],data.items[1]]);$scope.episodeGroups.push([data.items[2],data.items[3]]);}else{$scope.episodeGroups.push(data.items);}
nextPageToken=data.nextPageToken;if(nextPageToken){$scope.hasMore=true;}else{$scope.hasMore=false;}
$log.log("Episodes",$scope.episodeGroups);$log.log("featured episode",$scope.featuredEpisode);$timeout(function(){$(document).foundation('equalizer','reflow');},500,false);loadMore=true;}
$scope.loadMoreEpisodes=function(){if(!loadMore){return;}
loadMore=false;if(isFirstTime==="yes"){pageSize++;isFirstTime="no";}else if(isFirstTime==="no"){pageSize--;isFirstTime="";}
youtubeApi.listPlaylistItems($scope.initData.playlistId,pageSize,nextPageToken,["snippet","contentDetails"]).success(episodeListSuccess);}
$scope.loadMoreEpisodes();function showStickyHeadline(articleMedia,articleHead,stickyHead,headerDiv){var pos=articleMedia.offset();if($(window).scrollTop()>pos.top&&!$scope.nagging){$log.log("show");$scope.nagging=true;stickyHead.css({"width":articleHead.outerWidth()});stickyHead.fadeIn();}else if($(window).scrollTop()<=pos.top&&$scope.nagging){$log.log("hide");$scope.nagging=false;stickyHead.fadeOut();}}
$scope.encodeURIComponent=window.encodeURIComponent;$scope.ogUrl=$("[property='og:url']").prop("content").replace(/^(https?:\/\/[^\/]*)/i,'');}]);'user strict'
snaApp.controller("mostPopularStoriesController",["$scope",function($scope){$scope.mostPopularStoriesContent=$scope.component.contents;$scope.popularStoriesList=[];$scope.popularStoriesListImages=[];var mostPopular=0;for(var i=1;i<$scope.component.contents.length;i++){$scope.popularStoriesList[mostPopular]=$scope.component.contents[i];mostPopular++;}}]);